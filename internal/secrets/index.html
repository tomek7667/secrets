<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, viewport-fit=cover"
		/>
		<meta name="color-scheme" content="dark" />
		<title>Secrets Dashboard</title>

		<style>
			:root {
				--bg: #020617;
				--bg-elevated: rgba(15, 23, 42, 0.96);
				--bg-soft: rgba(15, 23, 42, 0.9);
				--border-subtle: rgba(148, 163, 184, 0.45);
				--accent: #38bdf8;
				--accent-soft: rgba(56, 189, 248, 0.16);
				--accent-strong: #0ea5e9;
				--danger: #f97373;
				--danger-soft: rgba(239, 68, 68, 0.14);
				--success: #4ade80;
				--success-soft: rgba(34, 197, 94, 0.16);
				--text: #e5e7eb;
				--muted: #9ca3af;
				--radius-lg: 18px;
				--radius-xl: 24px;
				--radius-full: 999px;
				--shadow-soft: 0 22px 70px rgba(15, 23, 42, 0.9);
				--transition-fast: 0.18s ease-out;
				--transition-med: 0.24s cubic-bezier(0.22, 0.61, 0.36, 1);
			}

			*,
			*::before,
			*::after {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			html,
			body {
				height: 100%;
			}

			body {
				font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
					sans-serif;
				background: radial-gradient(
					circle at top left,
					#0f172a 0,
					#020617 42%,
					#020617 100%
				);
				color: var(--text);
				min-height: 100vh;
				display: flex;
				align-items: stretch;
				justify-content: center;
				overflow-x: hidden;
				-webkit-font-smoothing: antialiased;
				position: relative;
			}

			body::before {
				content: "";
				position: fixed;
				inset: -160px;
				background: radial-gradient(
						circle at 0% 0%,
						rgba(56, 189, 248, 0.22),
						transparent 55%
					),
					radial-gradient(
						circle at 100% 0%,
						rgba(129, 140, 248, 0.18),
						transparent 60%
					);
				filter: blur(10px);
				opacity: 0.8;
				z-index: -2;
				pointer-events: none;
			}

			body::after {
				content: "";
				position: fixed;
				inset: 0;
				background: radial-gradient(
						900px 900px at 80% 120%,
						rgba(45, 212, 191, 0.16),
						transparent
					),
					radial-gradient(
						900px 900px at -20% 120%,
						rgba(129, 140, 248, 0.14),
						transparent
					);
				opacity: 0.7;
				z-index: -3;
				pointer-events: none;
			}

			body.modal-open {
				overflow: hidden;
			}

			.app-shell {
				width: 100%;
				max-width: 1200px;
				margin: 18px auto 32px;
				padding: 12px;
				display: flex;
				align-items: stretch;
				justify-content: center;
			}

			h1,
			h2,
			h3 {
				font-weight: 600;
				letter-spacing: 0.01em;
			}

			.hidden {
				display: none !important;
			}

			/* LOGIN */

			.login-box {
				width: 100%;
				max-width: 420px;
				margin: auto;
				padding: 26px 24px 24px;
				background: var(--bg-elevated);
				border-radius: var(--radius-lg);
				border: 1px solid var(--border-subtle);
				box-shadow: var(--shadow-soft);
				position: relative;
				overflow: hidden;
				animation: floatIn var(--transition-med);
			}

			.login-box::before {
				content: "";
				position: absolute;
				inset: -40%;
				background: radial-gradient(
						circle at 0 0,
						rgba(56, 189, 248, 0.2),
						transparent 55%
					),
					radial-gradient(
						circle at 100% 0,
						rgba(129, 140, 248, 0.18),
						transparent 55%
					);
				opacity: 0.7;
				z-index: -1;
			}

			.login-box h2 {
				margin-bottom: 20px;
				text-align: center;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 8px;
				font-size: 20px;
			}

			.login-box h2 span {
				font-size: 22px;
			}

			/* DASHBOARD CONTAINER */

			.container {
				flex: 1 1 auto;
				max-width: 1200px;
				margin: 0 auto;
				padding: 24px 22px 26px;
				background: var(--bg-elevated);
				border-radius: var(--radius-xl);
				border: 1px solid var(--border-subtle);
				box-shadow: var(--shadow-soft);
				backdrop-filter: blur(18px);
				animation: floatIn var(--transition-med);
			}

			.topbar {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 16px;
				margin-bottom: 18px;
			}

			.topbar-main {
				display: flex;
				flex-direction: column;
				gap: 4px;
			}

			h1 {
				font-size: 22px;
				display: flex;
				align-items: center;
				gap: 8px;
				color: #f9fafb;
			}

			.subtitle {
				font-size: 13px;
				color: var(--muted);
			}

			.topbar-meta {
				display: flex;
				align-items: center;
				gap: 10px;
				flex-wrap: wrap;
			}

			.session-pill {
				padding: 3px 10px;
				border-radius: var(--radius-full);
				border: 1px solid rgba(148, 163, 184, 0.5);
				font-size: 11px;
				letter-spacing: 0.08em;
				text-transform: uppercase;
				display: inline-flex;
				align-items: center;
				gap: 6px;
				background: rgba(15, 23, 42, 0.96);
				color: #e5e7eb;
			}

			.session-pill::before {
				content: "";
				width: 8px;
				height: 8px;
				border-radius: 999px;
				background: #22c55e;
				box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.32);
			}

			/* TOAST */

			.toast {
				position: fixed;
				right: 22px;
				bottom: 22px;
				z-index: 1000;
				min-width: 220px;
				max-width: 320px;
				padding: 10px 14px;
				border-radius: 999px;
				font-size: 13px;
				line-height: 1.3;
				background: rgba(15, 23, 42, 0.98);
				border: 1px solid rgba(148, 163, 184, 0.7);
				color: var(--text);
				box-shadow: var(--shadow-soft);
				display: flex;
				align-items: center;
				gap: 8px;
				transform: translateY(4px);
				opacity: 0;
				pointer-events: none;
				transition: opacity var(--transition-fast),
					transform var(--transition-fast);
			}

			.toast::before {
				content: "";
				width: 8px;
				height: 8px;
				border-radius: 999px;
				background: #f97373;
				box-shadow: 0 0 0 4px rgba(248, 113, 113, 0.2);
			}

			.toast.show {
				opacity: 1;
				transform: translateY(0);
				pointer-events: auto;
			}

			.toast[data-type="success"] {
				border-color: rgba(74, 222, 128, 0.9);
			}

			.toast[data-type="success"]::before {
				background: #22c55e;
				box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2);
			}

			.toast[data-type="info"] {
				border-color: rgba(56, 189, 248, 0.8);
			}

			.toast[data-type="info"]::before {
				background: #38bdf8;
				box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.18);
			}

			/* FORMS / INPUTS / BUTTONS */

			label {
				color: var(--muted);
				font-size: 12px;
				letter-spacing: 0.03em;
				text-transform: uppercase;
			}

			input,
			button,
			select {
				font-family: inherit;
				font-size: 14px;
			}

			input,
			select {
				width: 100%;
				padding: 9px 11px;
				margin-top: 4px;
				margin-bottom: 10px;
				background: rgba(15, 23, 42, 0.95);
				border: 1px solid rgba(55, 65, 81, 0.95);
				border-radius: 999px;
				color: var(--text);
				outline: none;
				transition: border-color var(--transition-fast),
					box-shadow var(--transition-fast), background var(--transition-fast),
					transform var(--transition-fast), opacity var(--transition-fast);
			}

			input:focus,
			select:focus {
				border-color: rgba(56, 189, 248, 0.9);
				box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6),
					0 0 0 10px rgba(56, 189, 248, 0.12);
				background: rgba(15, 23, 42, 0.98);
			}

			input::placeholder {
				color: rgba(148, 163, 184, 0.7);
			}

			button {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				gap: 6px;
				padding: 9px 14px;
				margin: 0;
				width: 100%;
				border-radius: var(--radius-full);
				border: none;
				outline: none;
				cursor: pointer;
				background: linear-gradient(135deg, #22d3ee, #38bdf8);
				color: #020617;
				font-weight: 600;
				font-size: 13px;
				box-shadow: 0 0 0 1px rgba(8, 47, 73, 0.7),
					0 18px 30px rgba(8, 47, 73, 0.75);
				transition: transform var(--transition-fast),
					box-shadow var(--transition-fast), filter var(--transition-fast),
					background var(--transition-fast), opacity var(--transition-fast);
				white-space: nowrap;
				position: relative;
			}

			button:hover {
				filter: brightness(1.05);
				box-shadow: 0 0 0 1px rgba(8, 47, 73, 0.8),
					0 18px 40px rgba(8, 47, 73, 0.9);
			}

			button:active {
				filter: brightness(0.95);
				box-shadow: 0 0 0 1px rgba(8, 47, 73, 0.8),
					0 12px 25px rgba(8, 47, 73, 0.9);
			}

			button:disabled {
				opacity: 0.6;
				cursor: default;
				transform: none;
				box-shadow: none;
			}

			button.secondary {
				background: radial-gradient(
					135% 200% at 0% 0%,
					rgba(15, 23, 42, 0.98),
					rgba(15, 23, 42, 0.92)
				);
				color: var(--text);
				border: 1px solid rgba(55, 65, 81, 0.9);
				box-shadow: 0 0 0 1px rgba(15, 23, 42, 1),
					0 16px 26px rgba(15, 23, 42, 0.85);
			}

			button.secondary:hover {
				background: radial-gradient(
					135% 200% at 0% 0%,
					rgba(15, 23, 42, 1),
					rgba(17, 24, 39, 1)
				);
			}

			button.danger {
				background: linear-gradient(135deg, #ef4444, #f97316);
				color: #fef2f2;
				border: none;
				box-shadow: 0 0 0 1px rgba(127, 29, 29, 0.8),
					0 18px 30px rgba(127, 29, 29, 0.9);
			}

			button.danger:hover {
				filter: brightness(1.05);
			}

			button.logout {
				padding-inline: 13px;
				font-size: 12px;
				width: auto;
			}

			/* button loading spinner */
			button[data-loading="1"] {
				color: transparent !important;
				pointer-events: none;
			}

			button[data-loading="1"]::after {
				content: "";
				width: 14px;
				height: 14px;
				border-radius: 999px;
				border: 2px solid rgba(248, 250, 252, 0.32);
				border-top-color: #f9fafb;
				animation: spin 0.7s linear infinite;
				position: absolute;
			}

			.btn-row {
				display: flex;
				gap: 10px;
				margin-top: 16px;
			}

			.btn-row button {
				flex: 1;
			}

			.form-row {
				margin-bottom: 14px;
				display: flex;
				flex-direction: column;
				gap: 4px;
			}

			/* TABS */

			.tabs {
				position: relative;
				display: inline-flex;
				align-items: center;
				gap: 4px;
				padding: 4px;
				margin-bottom: 14px;
				border-radius: var(--radius-full);
				border: 1px solid rgba(148, 163, 184, 0.4);
				background: radial-gradient(
					160% 220% at 0% 0%,
					rgba(15, 23, 42, 0.96),
					rgba(15, 23, 42, 0.86)
				);
			}

			.tab {
				position: relative;
				flex: 1 1 0;
				padding: 7px 12px;
				border-radius: var(--radius-full);
				border: none;
				background: transparent;
				color: var(--muted);
				font-size: 13px;
				font-weight: 500;
				cursor: pointer;
				transition: color var(--transition-fast),
					transform var(--transition-fast), background var(--transition-fast),
					box-shadow var(--transition-fast);
				white-space: nowrap;
			}

			.tab span {
				display: inline-flex;
				align-items: center;
				gap: 6px;
			}

			.tab::before {
				content: "";
				position: absolute;
				inset: 2px;
				border-radius: inherit;
				background: radial-gradient(
					140% 260% at 0% 0%,
					rgba(56, 189, 248, 0.08),
					transparent
				);
				opacity: 0;
				transition: opacity var(--transition-fast);
				z-index: -1;
			}

			.tab:hover::before {
				opacity: 1;
			}

			.tab:hover {
				color: #e5e7eb;
			}

			.tab.active {
				background: linear-gradient(
					135deg,
					rgba(56, 189, 248, 0.16),
					rgba(8, 47, 73, 0.9)
				);
				color: #f9fafb;
				box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6),
					0 16px 30px rgba(8, 47, 73, 0.85);
			}

			.tab.active::before {
				opacity: 1;
				background: radial-gradient(
					180% 260% at 0% 0%,
					rgba(56, 189, 248, 0.25),
					transparent
				);
			}

			.tab-content {
				margin-top: 2px;
				min-height: 240px;
			}

			.tab-content.hidden {
				display: none;
			}

			.tab-content.active-panel {
				animation: fadeInUp 0.22s ease-out;
			}

			.header {
				display: flex;
				align-items: flex-end;
				justify-content: space-between;
				gap: 12px;
				margin-bottom: 8px;
			}

			.header-title-block {
				display: flex;
				flex-direction: column;
				gap: 2px;
			}

			.header h2 {
				color: #f9fafb;
				font-size: 17px;
			}

			.header-subtitle {
				font-size: 12px;
				color: var(--muted);
			}

			.header-actions {
				display: flex;
				align-items: center;
				gap: 10px;
				flex-wrap: wrap;
			}

			.header-actions .field-inline {
				min-width: 140px;
				max-width: 220px;
				width: 100%;
			}

			.header-actions input {
				margin: 0;
				font-size: 13px;
			}

			/* TABLES */

			.table-wrapper {
				margin-top: 12px;
				border-radius: 16px;
				border: 1px solid rgba(15, 23, 42, 1);
				background: radial-gradient(
					140% 260% at 0% 0%,
					rgba(15, 23, 42, 0.98),
					rgba(15, 23, 42, 0.92)
				);
				box-shadow: inset 0 1px 0 rgba(148, 163, 184, 0.16);
				overflow: hidden;
			}

			table {
				width: 100%;
				border-collapse: collapse;
				min-width: 100%;
			}

			th,
			td {
				padding: 10px 12px;
				text-align: left;
				border-bottom: 1px solid rgba(31, 41, 55, 0.85);
				font-size: 13px;
			}

			th {
				background: rgba(15, 23, 42, 0.98);
				color: rgba(156, 163, 175, 0.98);
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.06em;
				font-size: 11px;
			}

			tr:nth-child(2n) td {
				background: rgba(15, 23, 42, 0.96);
			}

			tr:nth-child(2n + 1) td {
				background: rgba(15, 23, 42, 0.98);
			}

			tbody tr {
				transition: background 0.18s ease-out, transform 0.18s ease-out;
			}

			tbody tr:hover td {
				background: radial-gradient(
					160% 240% at 0% 0%,
					rgba(15, 23, 42, 1),
					rgba(15, 23, 42, 0.98)
				);
			}

			tbody tr:hover {
				background: rgba(56, 189, 248, 0.04);
			}

			.actions {
				display: flex;
				flex-wrap: wrap;
				gap: 6px;
			}

			.actions button {
				width: auto;
				padding-inline: 9px;
				font-size: 11px;
			}

			.empty-cell {
				text-align: center;
				padding: 18px 12px;
				color: var(--muted);
				font-size: 13px;
			}

			/* SPECIAL TEXT */

			.mono {
				font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
					"Liberation Mono", "Courier New", monospace;
				font-size: 12px;
				background: rgba(15, 23, 42, 0.95);
				padding: 2px 6px;
				border-radius: 999px;
				border: 1px solid rgba(31, 41, 55, 0.9);
			}

			.secret-value,
			.token-value {
				display: inline-flex;
				align-items: center;
				min-width: 80px;
				padding: 4px 8px;
				border-radius: 999px;
				border: 1px dashed rgba(75, 85, 99, 0.9);
				background: rgba(15, 23, 42, 0.98);
				cursor: pointer;
				user-select: none;
				transition: background var(--transition-fast),
					border-color var(--transition-fast), transform var(--transition-fast);
			}

			.secret-value:hover,
			.token-value:hover {
				background: rgba(15, 23, 42, 1);
				border-color: rgba(148, 163, 184, 0.9);
			}

			.spoiler {
				cursor: pointer;
			}

			.badge {
				padding: 3px 8px;
				border-radius: 999px;
				font-size: 11px;
				background: rgba(15, 23, 42, 1);
				border: 1px solid rgba(55, 65, 81, 1);
				display: inline-flex;
				align-items: center;
				gap: 6px;
			}

			.badge.valid {
				background: var(--success-soft);
				border-color: rgba(22, 163, 74, 0.9);
				color: #bbf7d0;
			}

			.badge.valid::before,
			.badge.expired::before {
				content: "";
				width: 6px;
				height: 6px;
				border-radius: 999px;
			}

			.badge.valid::before {
				background: #22c55e;
			}

			.badge.expired {
				background: var(--danger-soft);
				border-color: rgba(239, 68, 68, 0.9);
				color: #fecaca;
			}

			.badge.expired::before {
				background: #f97373;
			}

			.error {
				background: rgba(248, 81, 73, 0.16);
				border: 1px solid #f85149;
				padding: 8px 10px;
				border-radius: 999px;
				margin-bottom: 12px;
				color: #fecaca;
				font-size: 13px;
			}

			.success {
				background: rgba(35, 134, 54, 0.16);
				border: 1px solid #238636;
				padding: 8px 10px;
				border-radius: 999px;
				margin-bottom: 12px;
				color: #bbf7d0;
				font-size: 13px;
			}

			/* MODALS */

			.modal {
				display: none;
				position: fixed;
				inset: 0;
				background: rgba(2, 6, 23, 0.93);
				backdrop-filter: blur(18px);
				justify-content: center;
				align-items: center;
				z-index: 200;
				padding: 20px;
			}

			.modal.show {
				display: flex;
				animation: fadeIn 0.15s ease-out;
			}

			.modal-content {
				background: rgba(15, 23, 42, 1);
				padding: 20px 20px 18px;
				border-radius: 18px;
				border: 1px solid var(--border-subtle);
				min-width: min(460px, 100%);
				max-width: 500px;
				box-shadow: var(--shadow-soft);
				position: relative;
				animation: popIn 0.2s ease-out;
			}

			.modal-content h3 {
				margin-bottom: 14px;
				font-size: 17px;
			}

			.modal-close {
				position: absolute;
				top: 10px;
				right: 10px;
				width: 26px;
				height: 26px;
				border-radius: 999px;
				border: 1px solid rgba(55, 65, 81, 1);
				background: rgba(15, 23, 42, 0.98);
				color: var(--muted);
				display: inline-flex;
				align-items: center;
				justify-content: center;
				font-size: 14px;
				cursor: pointer;
				transition: background var(--transition-fast),
					color var(--transition-fast), transform var(--transition-fast);
			}

			.modal-close:hover {
				background: rgba(15, 23, 42, 1);
				color: #e5e7eb;
			}

			/* TABLE LOADING SKELETON */

			.skeleton-row {
				position: relative;
				overflow: hidden;
			}

			.skeleton {
				display: inline-block;
				height: 10px;
				border-radius: 999px;
				background: rgba(31, 41, 55, 1);
				overflow: hidden;
				position: relative;
			}

			.skeleton::after {
				content: "";
				position: absolute;
				inset: 0;
				background: linear-gradient(
					90deg,
					transparent,
					rgba(148, 163, 184, 0.28),
					transparent
				);
				animation: shimmer 1.3s infinite;
			}

			/* RESPONSIVE */

			@media (max-width: 768px) {
				.app-shell {
					margin-block: 10px 20px;
					padding-inline: 10px;
				}

				.container {
					padding: 18px 14px 20px;
					border-radius: 18px;
				}

				.topbar {
					flex-direction: column;
					align-items: flex-start;
					gap: 10px;
				}

				.topbar-meta {
					width: 100%;
					justify-content: space-between;
				}

				.header {
					flex-direction: column;
					align-items: flex-start;
					gap: 8px;
				}

				.header-actions {
					width: 100%;
					justify-content: space-between;
				}

				.header-actions .field-inline {
					max-width: none;
				}

				.actions {
					justify-content: flex-start;
				}

				.toast {
					left: 50%;
					right: auto;
					transform: translate(-50%, 18px) scale(0.97);
				}

				.toast.show {
					transform: translate(-50%, 0) scale(1);
				}
			}

			/* ANIMATIONS */

			@keyframes floatIn {
				from {
					opacity: 0;
					transform: translateY(4px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@keyframes fadeInUp {
				from {
					opacity: 0;
					transform: translateY(2px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
				}
				to {
					opacity: 1;
				}
			}

			@keyframes popIn {
				from {
					opacity: 0;
				}
				to {
					opacity: 1;
				}
			}

			@keyframes spin {
				to {
					transform: rotate(360deg);
				}
			}

			@keyframes shimmer {
				0% {
					transform: translateX(-100%);
				}
				100% {
					transform: translateX(100%);
				}
			}

			@media (prefers-reduced-motion: reduce) {
				*,
				*::before,
				*::after {
					animation-duration: 0.001ms !important;
					animation-iteration-count: 1 !important;
					transition-duration: 0.001ms !important;
				}
			}
		</style>
	</head>
	<body>
		<div class="app-shell">
			<!-- LOGIN -->
			<div id="login-page" class="login-box">
				<h2><span>üîê</span><span>Secrets Login</span></h2>
				<div id="login-error" class="error hidden"></div>
				<form id="login-form" autocomplete="on">
					<div class="form-row">
						<label for="username">Username</label>
						<input type="text" id="username" required autocomplete="username" />
					</div>
					<div class="form-row">
						<label for="password">Password</label>
						<input
							type="password"
							id="password"
							required
							autocomplete="current-password"
						/>
					</div>
					<button type="submit">Sign in</button>
				</form>
			</div>

			<!-- DASHBOARD -->
			<div id="dashboard" class="container hidden">
				<div class="topbar">
					<div class="topbar-main">
						<h1>üîê Secrets Dashboard</h1>
						<p class="subtitle">
							Securely manage secrets, users, tokens and fine-grained
							permissions.
						</p>
					</div>
					<!-- <div class="topbar-meta">
						<button type="button" class="secondary logout" id="logout-btn">
							Logout
						</button>
					</div> -->
				</div>

				<div class="tabs" role="tablist">
					<button
						class="tab active"
						data-tab="secrets"
						role="tab"
						aria-selected="true"
					>
						<span>Secrets</span>
					</button>
					<button class="tab" data-tab="users" role="tab" aria-selected="false">
						<span>Users</span>
					</button>
					<button
						class="tab"
						data-tab="tokens"
						role="tab"
						aria-selected="false"
					>
						<span>Tokens</span>
					</button>
					<button
						class="tab"
						data-tab="permissions"
						role="tab"
						aria-selected="false"
					>
						<span>Permissions</span>
					</button>
				</div>

				<button type="button" class="secondary logout" id="logout-btn">
					Logout
				</button>

				<!-- SECRETS TAB -->
				<div id="secrets-tab" class="tab-content active-panel" role="tabpanel">
					<div class="header">
						<div class="header-title-block">
							<h2>Secrets</h2>
							<p class="header-subtitle">
								Key/value pairs stored encrypted on the server.
							</p>
						</div>
						<div class="header-actions">
							<div class="field-inline">
								<input
									type="text"
									id="secrets-filter"
									placeholder="Filter by key‚Ä¶"
									autocomplete="off"
								/>
							</div>
							<button
								type="button"
								data-modal-target="secret-modal"
								style="width: auto"
							>
								<span>Ôºã New Secret</span>
							</button>
						</div>
					</div>
					<div class="table-wrapper">
						<table>
							<thead>
								<tr>
									<th>Key</th>
									<th>Value</th>
									<th>Created</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="secrets-table" data-cols="4"></tbody>
						</table>
					</div>
				</div>

				<!-- USERS TAB -->
				<div id="users-tab" class="tab-content hidden" role="tabpanel">
					<div class="header">
						<div class="header-title-block">
							<h2>Users</h2>
							<p class="header-subtitle">
								Manage dashboard accounts that can log in here.
							</p>
						</div>
						<div class="header-actions">
							<button
								type="button"
								data-modal-target="user-modal"
								style="width: auto"
							>
								<span>Ôºã Add User</span>
							</button>
						</div>
					</div>
					<div class="table-wrapper">
						<table>
							<thead>
								<tr>
									<th>ID</th>
									<th>Username</th>
									<th>Created</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="users-table" data-cols="4"></tbody>
						</table>
					</div>
				</div>

				<!-- TOKENS TAB -->
				<div id="tokens-tab" class="tab-content hidden" role="tabpanel">
					<div class="header">
						<div class="header-title-block">
							<h2>Tokens</h2>
							<p class="header-subtitle">
								Access tokens for API clients. Use with permissions below.
							</p>
						</div>
						<div class="header-actions">
							<button
								type="button"
								data-modal-target="token-modal"
								style="width: auto"
							>
								<span>Ôºã Add Token</span>
							</button>
						</div>
					</div>
					<div class="table-wrapper">
						<table>
							<thead>
								<tr>
									<th>ID</th>
									<th>Token</th>
									<th>Expires</th>
									<th>Status</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="tokens-table" data-cols="5"></tbody>
						</table>
					</div>
				</div>

				<!-- PERMISSIONS TAB -->
				<div id="permissions-tab" class="tab-content hidden" role="tabpanel">
					<div class="header">
						<div class="header-title-block">
							<h2>Permissions</h2>
							<p class="header-subtitle">
								Per-token patterns controlling which secrets can be read.
							</p>
						</div>
						<div class="header-actions">
							<button
								type="button"
								data-modal-target="permission-modal"
								style="width: auto"
							>
								<span>Ôºã Add Permission</span>
							</button>
						</div>
					</div>
					<div class="table-wrapper">
						<table>
							<thead>
								<tr>
									<th>ID</th>
									<th>Token ID</th>
									<th>Secret Key Pattern</th>
									<th>Created</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="permissions-table" data-cols="5"></tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!-- GLOBAL TOAST -->
		<div id="global-toast" class="toast" aria-live="polite"></div>

		<!-- MODALS -->

		<!-- Add Secret -->
		<div id="secret-modal" class="modal">
			<div class="modal-content">
				<button
					type="button"
					class="modal-close"
					data-close-modal="secret-modal"
					aria-label="Close"
				>
					√ó
				</button>
				<h3>Add Secret</h3>
				<form id="secret-form">
					<div class="form-row">
						<label for="secret-key">Key</label>
						<input type="text" id="secret-key" required />
					</div>
					<div class="form-row">
						<label for="secret-value">Value</label>
						<input type="text" id="secret-value" required />
					</div>
					<div class="btn-row">
						<button
							type="button"
							class="secondary"
							data-close-modal="secret-modal"
						>
							Cancel
						</button>
						<button type="submit">Create</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Add User -->
		<div id="user-modal" class="modal">
			<div class="modal-content">
				<button
					type="button"
					class="modal-close"
					data-close-modal="user-modal"
					aria-label="Close"
				>
					√ó
				</button>
				<h3>Add User</h3>
				<form id="user-form">
					<div class="form-row">
						<label for="new-username">Username</label>
						<input type="text" id="new-username" required />
					</div>
					<div class="form-row">
						<label for="new-password">Password</label>
						<input type="password" id="new-password" required />
					</div>
					<div class="btn-row">
						<button
							type="button"
							class="secondary"
							data-close-modal="user-modal"
						>
							Cancel
						</button>
						<button type="submit">Create</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Add Token -->
		<div id="token-modal" class="modal">
			<div class="modal-content">
				<button
					type="button"
					class="modal-close"
					data-close-modal="token-modal"
					aria-label="Close"
				>
					√ó
				</button>
				<h3>Add Token</h3>
				<form id="token-form">
					<div class="form-row">
						<label for="token-value">Token Value</label>
						<input type="text" id="token-value" required />
					</div>
					<div class="form-row">
						<label for="token-expires">Expires At (optional)</label>
						<input type="datetime-local" id="token-expires" />
					</div>
					<div class="btn-row">
						<button
							type="button"
							class="secondary"
							data-close-modal="token-modal"
						>
							Cancel
						</button>
						<button type="submit">Create</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Add Permission -->
		<div id="permission-modal" class="modal">
			<div class="modal-content">
				<button
					type="button"
					class="modal-close"
					data-close-modal="permission-modal"
					aria-label="Close"
				>
					√ó
				</button>
				<h3>Add Permission</h3>
				<form id="permission-form">
					<div class="form-row">
						<label for="permission-token">Token</label>
						<select id="permission-token" required></select>
					</div>
					<div class="form-row">
						<label for="permission-pattern">Secret Key Pattern</label>
						<input
							type="text"
							id="permission-pattern"
							required
							placeholder="e.g., prod/* or exact-key"
						/>
					</div>
					<div class="btn-row">
						<button
							type="button"
							class="secondary"
							data-close-modal="permission-modal"
						>
							Cancel
						</button>
						<button type="submit">Create</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Edit Secret -->
		<div id="edit-secret-modal" class="modal">
			<div class="modal-content">
				<button
					type="button"
					class="modal-close"
					data-close-modal="edit-secret-modal"
					aria-label="Close"
				>
					√ó
				</button>
				<h3>Edit Secret</h3>
				<form id="edit-secret-form">
					<input type="hidden" id="edit-secret-key" />
					<div class="form-row">
						<label for="edit-secret-value">New Value</label>
						<input type="text" id="edit-secret-value" required />
					</div>
					<div class="btn-row">
						<button
							type="button"
							class="secondary"
							data-close-modal="edit-secret-modal"
						>
							Cancel
						</button>
						<button type="submit">Update</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Edit Permission -->
		<div id="edit-permission-modal" class="modal">
			<div class="modal-content">
				<button
					type="button"
					class="modal-close"
					data-close-modal="edit-permission-modal"
					aria-label="Close"
				>
					√ó
				</button>
				<h3>Edit Permission</h3>
				<form id="edit-permission-form">
					<input type="hidden" id="edit-permission-id" />
					<div class="form-row">
						<label for="edit-permission-pattern">Secret Key Pattern</label>
						<input
							type="text"
							id="edit-permission-pattern"
							required
							placeholder="e.g., prod/* or exact-key"
						/>
					</div>
					<div class="btn-row">
						<button
							type="button"
							class="secondary"
							data-close-modal="edit-permission-modal"
						>
							Cancel
						</button>
						<button type="submit">Update</button>
					</div>
				</form>
			</div>
		</div>

		<script>
			(() => {
				"use strict";

				const API = "";
				let token = localStorage.getItem("jwt") || "";
				let tokensList = [];

				const $ = (id) => document.getElementById(id);
				const qs = (sel, parent = document) => parent.querySelector(sel);
				const qsa = (sel, parent = document) =>
					Array.from(parent.querySelectorAll(sel));

				const esc = (value) =>
					String(value ?? "").replace(
						/[&<>"']/g,
						(c) =>
							({
								"&": "&amp;",
								"<": "&lt;",
								">": "&gt;",
								'"': "&quot;",
								"'": "&#39;",
							}[c])
					);

				const formatDate = (value) => {
					if (!value) return "‚Äî";
					const d = new Date(value);
					if (!Number.isFinite(d.getTime())) return "‚Äî";
					return d.toLocaleString();
				};

				const isExpired = (value) => {
					if (!value) return false;
					const d = new Date(value);
					if (!Number.isFinite(d.getTime())) return false;
					return d < new Date();
				};

				const api = async (method, path, body) => {
					const opts = {
						method,
						headers: { "Content-Type": "application/json" },
					};
					if (token) {
						opts.headers["Authorization"] = "Bearer " + token;
					}
					if (body !== undefined) {
						opts.body = JSON.stringify(body);
					}
					const res = await fetch(`${API}${path}`, opts);
					const data = await res.json();
					if (!res.ok) {
						if (data.code === 401) {
							logout();
						}
						throw new Error(
							data.message ?? data.statusText ?? "Request failed"
						);
					}
					return data.data;
				};

				const toast = $("global-toast");

				function showToast(message, type = "error") {
					if (!toast) {
						alert(message);
						return;
					}
					toast.textContent = message;
					toast.dataset.type = type;
					toast.classList.add("show");
					if (showToast._timer) {
						clearTimeout(showToast._timer);
					}
					showToast._timer = setTimeout(
						() => toast.classList.remove("show"),
						3200
					);
				}

				function setButtonLoading(btn, isLoading) {
					if (!btn) return;
					btn.disabled = !!isLoading;
					btn.dataset.loading = isLoading ? "1" : "0";
				}

				function setFormDisabled(form, disabled) {
					if (!form) return;
					const fields = qsa("input, select, textarea, button", form);
					fields.forEach((el) => {
						if (disabled) {
							if (el.disabled) {
								el.dataset.wasDisabled = "1";
							} else {
								el.dataset.wasDisabled = "0";
								el.disabled = true;
							}
						} else {
							if (el.dataset.wasDisabled === "0") {
								el.disabled = false;
							}
							delete el.dataset.wasDisabled;
						}
					});
				}

				function showModal(id) {
					const modal = $(id);
					if (!modal) return;
					modal.classList.add("show");
					document.body.classList.add("modal-open");
					const focusable = modal.querySelector(
						"input, select, textarea, button"
					);
					if (focusable) {
						setTimeout(() => focusable.focus(), 30);
					}
				}

				function hideModal(id) {
					const modal = $(id);
					if (!modal) return;
					modal.classList.remove("show");
					const form = modal.querySelector("form");
					if (form) form.reset();
					if (!document.querySelector(".modal.show")) {
						document.body.classList.remove("modal-open");
					}
				}

				function logout() {
					token = "";
					localStorage.removeItem("jwt");
					const loginPage = $("login-page");
					const dashboard = $("dashboard");
					if (dashboard) dashboard.classList.add("hidden");
					if (loginPage) loginPage.classList.remove("hidden");
					document.body.classList.remove("modal-open");
				}

				function setTableLoading(tbody, isLoading) {
					if (!tbody) return;
					const cols = Number(tbody.dataset.cols || "1");
					if (isLoading) {
						tbody.innerHTML = `
							<tr class="skeleton-row">
								<td colspan="${cols}" class="empty-cell">
									<span class="skeleton" style="width: 60%;"></span>
								</td>
							</tr>
							<tr class="skeleton-row">
								<td colspan="${cols}" class="empty-cell">
									<span class="skeleton" style="width: 40%;"></span>
								</td>
							</tr>
						`;
					}
				}

				async function loadSecrets() {
					const tbody = $("secrets-table");
					if (!tbody) return;
					setTableLoading(tbody, true);
					try {
						const secrets = await api("GET", "/api/secrets");
						if (!Array.isArray(secrets) || secrets.length === 0) {
							tbody.innerHTML =
								'<tr><td colspan="4" class="empty-cell">No secrets yet. Create your first one.</td></tr>';
							return;
						}
						const rows = secrets
							.map((s) => {
								let decoded = "";
								try {
									decoded = atob(s.value || "");
								} catch (_) {
									decoded = s.value || "";
								}
								const key = s.key || "";
								const created = formatDate(s.created_at);
								return `
									<tr
										data-secret-key="${esc(key)}"
										data-secret-value="${esc(decoded)}"
									>
										<td><span class="mono">${esc(key)}</span></td>
										<td>
											<span class="mono secret-value spoiler" data-hidden="1">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
										</td>
										<td>${created}</td>
										<td class="actions">
											<button type="button" class="secondary" data-action="copy-key">Copy Key</button>
											<button type="button" class="secondary" data-action="copy-value">Copy Value</button>
											<button type="button" class="secondary" data-action="edit-secret">Edit</button>
											<button type="button" class="danger" data-action="delete-secret">Delete</button>
										</td>
									</tr>
								`;
							})
							.join("");
						tbody.innerHTML = rows;
					} catch (err) {
						tbody.innerHTML = `<tr><td colspan="4" class="empty-cell">${esc(
							err.message || "Could not load secrets."
						)}</td></tr>`;
					}
				}

				async function loadUsers() {
					const tbody = $("users-table");
					if (!tbody) return;
					setTableLoading(tbody, true);
					try {
						const users = await api("GET", "/api/users");
						if (!Array.isArray(users) || users.length === 0) {
							tbody.innerHTML =
								'<tr><td colspan="4" class="empty-cell">No users yet.</td></tr>';
							return;
						}
						const rows = users
							.map((u) => {
								const id = u.id || "";
								const username = u.username || "";
								const created = formatDate(u.created_at);
								return `
									<tr data-user-id="${esc(id)}">
										<td><span class="mono">${esc(id.substring(0, 8))}‚Ä¶</span></td>
										<td>${esc(username)}</td>
										<td>${created}</td>
										<td class="actions">
											<button type="button" class="danger" data-action="delete-user">Delete</button>
										</td>
									</tr>
								`;
							})
							.join("");
						tbody.innerHTML = rows;
					} catch (err) {
						tbody.innerHTML = `<tr><td colspan="4" class="empty-cell">${esc(
							err.message || "Could not load users."
						)}</td></tr>`;
					}
				}

				function updateTokenSelect() {
					const select = $("permission-token");
					if (!select) return;
					if (!Array.isArray(tokensList) || tokensList.length === 0) {
						select.innerHTML = "";
						return;
					}
					select.innerHTML = tokensList
						.map((t) => {
							const id = t.id || "";
							const tokenVal = t.token || "";
							return `<option value="${esc(id)}">${esc(
								tokenVal.substring(0, 16)
							)}‚Ä¶ (${esc(id.substring(0, 8))}‚Ä¶)</option>`;
						})
						.join("");
				}

				async function loadTokens() {
					const tbody = $("tokens-table");
					if (!tbody) return;
					setTableLoading(tbody, true);
					try {
						const tokens = await api("GET", "/api/tokens");
						tokensList = Array.isArray(tokens) ? tokens : [];
						if (tokensList.length === 0) {
							tbody.innerHTML =
								'<tr><td colspan="5" class="empty-cell">No tokens yet.</td></tr>';
							updateTokenSelect();
							return;
						}
						const rows = tokensList
							.map((t) => {
								const id = t.id || "";
								const tokenVal = t.token || "";
								const expires = t.expires_at ? formatDate(t.expires_at) : "‚Äî";
								const expired = isExpired(t.expires_at);
								const statusClass = expired ? "expired" : "valid";
								const statusText = expired ? "Expired" : "Valid";
								return `
									<tr
										data-token-id="${esc(id)}"
										data-token-value="${esc(tokenVal)}"
									>
										<td><span class="mono">${esc(id.substring(0, 8))}‚Ä¶</span></td>
										<td>
											<span class="mono token-value spoiler" data-hidden="1">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
										</td>
										<td>${expires}</td>
										<td><span class="badge ${statusClass}">${statusText}</span></td>
										<td class="actions">
											<button type="button" class="secondary" data-action="copy-token">Copy Token</button>
											<button type="button" class="danger" data-action="delete-token">Delete</button>
										</td>
									</tr>
								`;
							})
							.join("");
						tbody.innerHTML = rows;
						updateTokenSelect();
					} catch (err) {
						tbody.innerHTML = `<tr><td colspan="5" class="empty-cell">${esc(
							err.message || "Could not load tokens."
						)}</td></tr>`;
					}
				}

				async function loadPermissions() {
					const tbody = $("permissions-table");
					if (!tbody) return;
					setTableLoading(tbody, true);
					try {
						const perms = await api("GET", "/api/permissions");
						if (!Array.isArray(perms) || perms.length === 0) {
							tbody.innerHTML =
								'<tr><td colspan="5" class="empty-cell">No permissions yet.</td></tr>';
							return;
						}
						const rows = perms
							.map((p) => {
								const id = p.id || "";
								const tokenId = p.token_id || "";
								const pattern = p.secret_key_pattern || "";
								const created = formatDate(p.created_at);
								return `
									<tr
										data-permission-id="${esc(id)}"
										data-permission-pattern="${esc(pattern)}"
									>
										<td><span class="mono">${esc(id.substring(0, 8))}‚Ä¶</span></td>
										<td><span class="mono">${esc(tokenId.substring(0, 8))}‚Ä¶</span></td>
										<td><span class="mono">${esc(pattern)}</span></td>
										<td>${created}</td>
										<td class="actions">
											<button type="button" class="secondary" data-action="edit-permission">Edit</button>
											<button type="button" class="danger" data-action="delete-permission">Delete</button>
										</td>
									</tr>
								`;
							})
							.join("");
						tbody.innerHTML = rows;
					} catch (err) {
						tbody.innerHTML = `<tr><td colspan="5" class="empty-cell">${esc(
							err.message || "Could not load permissions."
						)}</td></tr>`;
					}
				}

				function showDashboard() {
					const loginPage = $("login-page");
					const dashboard = $("dashboard");
					if (loginPage) loginPage.classList.add("hidden");
					if (dashboard) dashboard.classList.remove("hidden");
					loadSecrets();
					loadUsers();
					loadTokens();
					loadPermissions();
				}

				function initTabs() {
					const tabsContainer = qs(".tabs");
					if (!tabsContainer) return;
					const tabButtons = qsa(".tab", tabsContainer);
					const panels = qsa(".tab-content");

					const activateTab = (name) => {
						tabButtons.forEach((btn) => {
							const isActive = btn.dataset.tab === name;
							btn.classList.toggle("active", isActive);
							btn.setAttribute("aria-selected", isActive ? "true" : "false");
						});
						panels.forEach((panel) => {
							const shouldShow = panel.id === `${name}-tab`;
							panel.classList.toggle("hidden", !shouldShow);
							panel.classList.toggle("active-panel", shouldShow);
						});
					};

					tabsContainer.addEventListener("click", (event) => {
						const btn = event.target.closest(".tab");
						if (!btn) return;
						const name = btn.dataset.tab;
						if (!name) return;
						activateTab(name);
					});

					const initial =
						tabButtons.find((b) => b.classList.contains("active")) ||
						tabButtons[0];
					if (initial && initial.dataset.tab) {
						activateTab(initial.dataset.tab);
					}
				}

				function initModalEvents() {
					qsa(".modal").forEach((modal) => {
						modal.addEventListener("click", (event) => {
							if (event.target === modal) {
								modal.classList.remove("show");
								if (!document.querySelector(".modal.show")) {
									document.body.classList.remove("modal-open");
								}
							}
						});
					});

					document.addEventListener("keydown", (event) => {
						if (event.key === "Escape") {
							const open = qs(".modal.show");
							if (open) {
								open.classList.remove("show");
								if (!document.querySelector(".modal.show")) {
									document.body.classList.remove("modal-open");
								}
							}
						}
					});
				}

				function initModalTriggers() {
					qsa("[data-modal-target]").forEach((btn) => {
						btn.addEventListener("click", () => {
							const target = btn.getAttribute("data-modal-target");
							if (target) showModal(target);
						});
					});
					qsa("[data-close-modal]").forEach((btn) => {
						btn.addEventListener("click", () => {
							const target = btn.getAttribute("data-close-modal");
							if (target) hideModal(target);
						});
					});
				}

				function copyText(text, successMessage) {
					if (!text && text !== "") return;
					const fallback = () => {
						const ta = document.createElement("textarea");
						ta.value = text;
						ta.style.position = "fixed";
						ta.style.opacity = "0";
						document.body.appendChild(ta);
						ta.select();
						try {
							document.execCommand("copy");
							if (successMessage) showToast(successMessage, "success");
						} catch (_) {
							showToast("Could not copy to clipboard.", "error");
						}
						document.body.removeChild(ta);
					};

					if (navigator.clipboard && navigator.clipboard.writeText) {
						navigator.clipboard
							.writeText(text)
							.then(() => {
								if (successMessage) showToast(successMessage, "success");
							})
							.catch(fallback);
					} else {
						fallback();
					}
				}

				function initSecretsFilter() {
					const input = $("secrets-filter");
					if (!input) return;
					input.addEventListener("input", () => {
						const q = input.value.trim().toLowerCase();
						qsa("#secrets-table tr").forEach((row) => {
							const key = (row.dataset.secretKey || "").toLowerCase();
							row.style.display = !q || key.includes(q) ? "" : "none";
						});
					});
				}

				function initSecretsTableEvents() {
					const tbody = $("secrets-table");
					if (!tbody) return;
					tbody.addEventListener("click", (event) => {
						const target = event.target;
						if (!(target instanceof HTMLElement)) return;
						const row = target.closest("tr");
						if (!row) return;

						if (
							target.classList.contains("secret-value") ||
							target.classList.contains("spoiler")
						) {
							const val = row.dataset.secretValue || "";
							const hidden = target.dataset.hidden !== "0";
							target.textContent = hidden ? val : "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
							target.dataset.hidden = hidden ? "0" : "1";
							return;
						}

						const btn = target.closest("button[data-action]");
						if (!btn) return;
						const action = btn.dataset.action;
						const key = row.dataset.secretKey || "";
						const value = row.dataset.secretValue || "";

						if (action === "copy-key") {
							copyText(key, "Secret key copied.");
						} else if (action === "copy-value") {
							copyText(value, "Secret value copied.");
						} else if (action === "edit-secret") {
							$("edit-secret-key").value = key;
							$("edit-secret-value").value = value;
							showModal("edit-secret-modal");
						} else if (action === "delete-secret") {
							if (!window.confirm(`Delete secret "${key}"?`)) return;
							setButtonLoading(btn, true);
							api("DELETE", "/api/secrets?key=" + encodeURIComponent(key))
								.then(() => {
									showToast("Secret deleted.", "success");
									return loadSecrets();
								})
								.catch((err) =>
									showToast(err.message || "Failed to delete secret.", "error")
								)
								.finally(() => setButtonLoading(btn, false));
						}
					});
				}

				function initUsersTableEvents() {
					const tbody = $("users-table");
					if (!tbody) return;
					tbody.addEventListener("click", (event) => {
						const btn = event.target.closest("button[data-action]");
						if (!btn) return;
						const action = btn.dataset.action;
						const row = btn.closest("tr");
						if (!row) return;
						const userId = row.dataset.userId || "";
						if (action === "delete-user") {
							if (!window.confirm("Delete this user?")) return;
							setButtonLoading(btn, true);
							api("DELETE", "/api/users/" + encodeURIComponent(userId))
								.then(() => {
									showToast("User deleted.", "success");
									return loadUsers();
								})
								.catch((err) =>
									showToast(err.message || "Failed to delete user.", "error")
								)
								.finally(() => setButtonLoading(btn, false));
						}
					});
				}

				function initTokensTableEvents() {
					const tbody = $("tokens-table");
					if (!tbody) return;
					tbody.addEventListener("click", (event) => {
						const target = event.target;
						if (!(target instanceof HTMLElement)) return;
						const row = target.closest("tr");
						if (!row) return;

						if (
							target.classList.contains("token-value") ||
							target.classList.contains("spoiler")
						) {
							const val = row.dataset.tokenValue || "";
							const hidden = target.dataset.hidden !== "0";
							target.textContent = hidden ? val : "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
							target.dataset.hidden = hidden ? "0" : "1";
							return;
						}

						const btn = target.closest("button[data-action]");
						if (!btn) return;
						const action = btn.dataset.action;
						const tokenId = row.dataset.tokenId || "";
						const tokenVal = row.dataset.tokenValue || "";

						if (action === "copy-token") {
							copyText(tokenVal, "Token copied.");
						} else if (action === "delete-token") {
							if (!window.confirm("Delete this token?")) return;
							setButtonLoading(btn, true);
							api("DELETE", "/api/tokens/" + encodeURIComponent(tokenId))
								.then(() => {
									showToast("Token deleted.", "success");
									return Promise.all([loadTokens(), loadPermissions()]);
								})
								.catch((err) =>
									showToast(err.message || "Failed to delete token.", "error")
								)
								.finally(() => setButtonLoading(btn, false));
						}
					});
				}

				function initPermissionsTableEvents() {
					const tbody = $("permissions-table");
					if (!tbody) return;
					tbody.addEventListener("click", (event) => {
						const btn = event.target.closest("button[data-action]");
						if (!btn) return;
						const action = btn.dataset.action;
						const row = btn.closest("tr");
						if (!row) return;
						const permId = row.dataset.permissionId || "";
						const pattern = row.dataset.permissionPattern || "";

						if (action === "edit-permission") {
							$("edit-permission-id").value = permId;
							$("edit-permission-pattern").value = pattern;
							showModal("edit-permission-modal");
						} else if (action === "delete-permission") {
							if (!window.confirm("Delete this permission?")) return;
							setButtonLoading(btn, true);
							api("DELETE", "/api/permissions/" + encodeURIComponent(permId))
								.then(() => {
									showToast("Permission deleted.", "success");
									return loadPermissions();
								})
								.catch((err) =>
									showToast(
										err.message || "Failed to delete permission.",
										"error"
									)
								)
								.finally(() => setButtonLoading(btn, false));
						}
					});
				}

				function initForms() {
					const loginForm = $("login-form");
					if (loginForm) {
						loginForm.addEventListener("submit", (event) => {
							event.preventDefault();
							const errorBox = $("login-error");
							const submitBtn = loginForm.querySelector(
								'button[type="submit"]'
							);
							if (errorBox) {
								errorBox.classList.add("hidden");
								errorBox.textContent = "";
							}
							setFormDisabled(loginForm, true);
							setButtonLoading(submitBtn, true);
							api("POST", "/login", {
								username: $("username").value.trim(),
								password: $("password").value,
							})
								.then((res) => {
									token = res.token;
									localStorage.setItem("jwt", token);
									showDashboard();
								})
								.catch((err) => {
									const msg = err.message || "Login failed.";
									if (errorBox) {
										errorBox.textContent = msg;
										errorBox.classList.remove("hidden");
									}
									showToast(msg, "error");
								})
								.finally(() => {
									setFormDisabled(loginForm, false);
									setButtonLoading(submitBtn, false);
								});
						});
					}

					const secretForm = $("secret-form");
					if (secretForm) {
						secretForm.addEventListener("submit", (event) => {
							event.preventDefault();
							const submitBtn = secretForm.querySelector(
								'button[type="submit"]'
							);
							const key = $("secret-key").value.trim();
							const value = $("secret-value").value;
							if (!key || !value) return;
							setFormDisabled(secretForm, true);
							setButtonLoading(submitBtn, true);
							api("POST", "/api/secrets", { key, value })
								.then(() => {
									hideModal("secret-modal");
									showToast("Secret created.", "success");
									return loadSecrets();
								})
								.catch((err) =>
									showToast(err.message || "Failed to create secret.", "error")
								)
								.finally(() => {
									setFormDisabled(secretForm, false);
									setButtonLoading(submitBtn, false);
								});
						});
					}

					const editSecretForm = $("edit-secret-form");
					if (editSecretForm) {
						editSecretForm.addEventListener("submit", (event) => {
							event.preventDefault();
							const submitBtn = editSecretForm.querySelector(
								'button[type="submit"]'
							);
							const key = $("edit-secret-key").value;
							const value = $("edit-secret-value").value;
							setFormDisabled(editSecretForm, true);
							setButtonLoading(submitBtn, true);
							api("PUT", "/api/secrets?key=" + encodeURIComponent(key), {
								value,
							})
								.then(() => {
									hideModal("edit-secret-modal");
									showToast("Secret updated.", "success");
									return loadSecrets();
								})
								.catch((err) =>
									showToast(err.message || "Failed to update secret.", "error")
								)
								.finally(() => {
									setFormDisabled(editSecretForm, false);
									setButtonLoading(submitBtn, false);
								});
						});
					}

					const userForm = $("user-form");
					if (userForm) {
						userForm.addEventListener("submit", (event) => {
							event.preventDefault();
							const submitBtn = userForm.querySelector('button[type="submit"]');
							const username = $("new-username").value.trim();
							const password = $("new-password").value;
							if (!username || !password) return;
							setFormDisabled(userForm, true);
							setButtonLoading(submitBtn, true);
							api("POST", "/api/users", { username, password })
								.then(() => {
									hideModal("user-modal");
									showToast("User created.", "success");
									return loadUsers();
								})
								.catch((err) =>
									showToast(err.message || "Failed to create user.", "error")
								)
								.finally(() => {
									setFormDisabled(userForm, false);
									setButtonLoading(submitBtn, false);
								});
						});
					}

					const tokenForm = $("token-form");
					if (tokenForm) {
						tokenForm.addEventListener("submit", (event) => {
							event.preventDefault();
							const submitBtn = tokenForm.querySelector(
								'button[type="submit"]'
							);
							const tokenVal = $("token-value").value.trim();
							const expiresRaw = $("token-expires").value;
							if (!tokenVal) return;
							const body = { token: tokenVal };
							if (expiresRaw) {
								const dt = new Date(expiresRaw);
								if (Number.isFinite(dt.getTime())) {
									body.expires_at = dt.toISOString();
								}
							}
							setFormDisabled(tokenForm, true);
							setButtonLoading(submitBtn, true);
							api("POST", "/api/tokens", body)
								.then(() => {
									hideModal("token-modal");
									showToast("Token created.", "success");
									return loadTokens();
								})
								.catch((err) =>
									showToast(err.message || "Failed to create token.", "error")
								)
								.finally(() => {
									setFormDisabled(tokenForm, false);
									setButtonLoading(submitBtn, false);
								});
						});
					}

					const permissionForm = $("permission-form");
					if (permissionForm) {
						permissionForm.addEventListener("submit", (event) => {
							event.preventDefault();
							const submitBtn = permissionForm.querySelector(
								'button[type="submit"]'
							);
							const tokenId = $("permission-token").value;
							const pattern = $("permission-pattern").value.trim();
							if (!tokenId || !pattern) return;
							setFormDisabled(permissionForm, true);
							setButtonLoading(submitBtn, true);
							api("POST", "/api/permissions", {
								token_id: tokenId,
								secret_key_pattern: pattern,
							})
								.then(() => {
									hideModal("permission-modal");
									showToast("Permission created.", "success");
									return loadPermissions();
								})
								.catch((err) =>
									showToast(
										err.message || "Failed to create permission.",
										"error"
									)
								)
								.finally(() => {
									setFormDisabled(permissionForm, false);
									setButtonLoading(submitBtn, false);
								});
						});
					}

					const editPermissionForm = $("edit-permission-form");
					if (editPermissionForm) {
						editPermissionForm.addEventListener("submit", (event) => {
							event.preventDefault();
							const submitBtn = editPermissionForm.querySelector(
								'button[type="submit"]'
							);
							const id = $("edit-permission-id").value;
							const pattern = $("edit-permission-pattern").value.trim();
							if (!id || !pattern) return;
							setFormDisabled(editPermissionForm, true);
							setButtonLoading(submitBtn, true);
							api("PUT", "/api/permissions/" + encodeURIComponent(id), {
								secret_key_pattern: pattern,
							})
								.then(() => {
									hideModal("edit-permission-modal");
									showToast("Permission updated.", "success");
									return loadPermissions();
								})
								.catch((err) =>
									showToast(
										err.message || "Failed to update permission.",
										"error"
									)
								)
								.finally(() => {
									setFormDisabled(editPermissionForm, false);
									setButtonLoading(submitBtn, false);
								});
						});
					}
				}

				function initLogout() {
					const btn = $("logout-btn");
					if (!btn) return;
					btn.addEventListener("click", () => {
						logout();
					});
				}

				document.addEventListener("DOMContentLoaded", () => {
					initTabs();
					initModalEvents();
					initModalTriggers();
					initSecretsFilter();
					initSecretsTableEvents();
					initUsersTableEvents();
					initTokensTableEvents();
					initPermissionsTableEvents();
					initForms();
					initLogout();

					if (token) {
						showDashboard();
					}
				});
			})();
		</script>
	</body>
</html>
