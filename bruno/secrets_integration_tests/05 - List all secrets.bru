meta {
  name: 05 - List all secrets
  type: http
  seq: 5
}

get {
  url: {{burl}}/api/secrets
  body: none
  auth: inherit
}

headers {
  Authorization: Bearer {{admin_token}}
}

assert {
  res.status: eq 200
  res.body.success: eq true
  res.body.data: isArray
}

tests {
  test("Should return at least 3 secrets", function() {
    expect(res.getStatus()).to.equal(200);
    expect(res.getBody().data.length).to.be.at.least(3);
  });
  
  test("Should include AWS, GCP, and Azure secrets", function() {
    const keys = res.getBody().data.map(s => s.key);
    expect(keys.some(k => k.includes("arn:aws"))).to.be.true;
    expect(keys.some(k => k.includes("projects/"))).to.be.true;
    expect(keys.some(k => k.includes("vault.azure"))).to.be.true;
  });
}
