meta {
  name: 09 - Get secret using API token
  type: http
  seq: 9
}

get {
  url: {{burl}}/api/secrets/get?key={{aws_secret_key}}
  body: none
  auth: inherit
}

params:query {
  key: {{aws_secret_key}}
}

headers {
  Authorization: Api {{api_token}}
}

assert {
  res.status: eq 200
  res.body.success: eq true
}

tests {
  test("Get secret with API token should succeed", function() {
    expect(res.getStatus()).to.equal(200);
    const decodedValue = Buffer.from(res.getBody().data.value, 'base64').toString('utf-8');
    expect(decodedValue).to.equal("UpdatedAWSSecretValue999!");
  });
}
